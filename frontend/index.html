<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShopEase - Your Online Store</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-container">
      <div class="logo">ShopEase</div>
      <nav>
        <ul class="nav-links">
          <li><a href="#">Home</a></li>
          <li><a href="#">Products</a></li>
          <li><a href="#">Categories</a></li>
          <li><a href="#add-product">Add Product</a></li>
        </ul>
      </nav>
      <div class="search-cart">
        <!-- FIXED: Changed to inline JavaScript event handler and removed form action -->
        <form id="search-form" onsubmit="searchProduct(event)">
          <input type="text" id="search-input" name="query" placeholder="Search products..." />
          <button type="submit">Search</button>
        </form>
        <div class="cart-icon">
          üõí
        </div>
      </div>
    </div>
  </header>
  <!-- FIXED: Added dedicated search results container -->
  
  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1>Find Your Perfect Products</h1>
      <p>Shop the latest trends and discover amazing deals on the best products from around the world.</p>
      <a href="#" class="cta-button">Shop Now</a>
    </div>
  </section>

  <!-- Categories -->
  <section class="categories">
    <div class="container">
      <h2 class="section-title">Shop by Category</h2>
      <div class="category-grid">
        <div class="category-card">
          <img src="https://images.unsplash.com/photo-1586495777744-4413f21062fa?q=80&w=2583&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Electronics" class="category-image">
          <div class="category-name">Electronics</div>
        </div>
        <div class="category-card">
          <img src="https://images.unsplash.com/photo-1618483117619-7baef2anexion0db1f?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Fashion" class="category-image">
          <div class="category-name">Fashion</div>
        </div>
        <div class="category-card">
          <img src="https://images.unsplash.com/photo-1594534475808-b18fc33b045e?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Home & Garden" class="category-image">
          <div class="category-name">Home & Garden</div>
        </div>
        <div class="category-card">
          <img src="https://images.unsplash.com/photo-1540491688060-aa710a9f9d33?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Sports" class="category-image">
          <div class="category-name">Sports</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Products -->
  <section class="products">
    <div class="container">
      <h2 class="section-title">Featured Products</h2>
      <div class="product-controls">
        <div class="product-filters">
          <select name="sort">
            <option value="popular">Sort by: Popularity</option>
            <option value="price-asc">Price: Low to High</option>
            <option value="price-desc">Price: High to Low</option>
            <option value="newest">Newest First</option>
          </select>
        </div>
        <div class="view-options">
          <button class="active">Grid</button>
          <button>List</button>
        </div>
      </div>
      <div class="product-grid">
      </div>
     </div>
   
  </section>

  <!-- Add Product Section -->
  <section class="add-product-section" id="add-product">
    <div class="container">
      <h2 class="section-title">Add New Product</h2>
      <form class="add-product-form">
        <div class="form-group">
          <label for="productName">Product Name</label>
          <input type="text" id="productName" class="form-control" placeholder="Enter product name">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="productPrice">Price ($)</label>
            <input type="number" id="productPrice" class="form-control" placeholder="0.00">
          </div>
          <div class="form-group">
            <label for="productCategory">Category</label>
            <select id="productCategory" class="form-control">
              <option value="">Select Category</option>
              <option value="electronics">Electronics</option>
              <option value="fashion">Fashion</option>
              <option value="home">Home & Garden</option>
              <option value="sports">Sports</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="productDescription">Description</label>
          <textarea id="productDescription" class="form-control" placeholder="Describe your product..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Product Image</label>
          <div class="image-upload">
            <div class="image-upload-icon">üì∏</div>
            <input type="text" id="img" name="img" accept="image/*">
            <p class="text-muted">Upload your image Link</p>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="productQuantity">Quantity</label>
            <input type="number" id="productQuantity" class="form-control" placeholder="0">
          </div>
          <div class="form-group">
            <label for="productStatus">Status</label>
            <select id="productStatus" class="form-control">
              <option value="in-stock">In Stock</option>
              <option value="out-of-stock">Out of Stock</option>
              <option value="coming-soon">Coming Soon</option>
            </select>
          </div>
        </div>
        
        <button type="submit" class="submit-button">Add Product</button>
      </form>
    </div>
  </section>
<div id="result" class="container" style="margin-top: 20px;"></div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container footer-container">
      <div class="footer-column">
        <h3>ShopEase</h3>
        <p>Your one-stop shop for all your needs. Discover amazing products at competitive prices.</p>
        <div class="social-icons">
          <a href="#" aria-label="Facebook">f</a>
          <a href="#" aria-label="Twitter">t</a>
          <a href="#" aria-label="Instagram">i</a>
          <a href="#" aria-label="YouTube">y</a>
        </div>
      </div>
      
      <div class="footer-column">
        <h3>Quick Links</h3>
        <ul class="footer-links">
          <li><a href="#">Home</a></li>
          <li><a href="#">Products</a></li>
          <li><a href="#">Categories</a></li>
          <li><a href="#add-product">Add Product</a></li>
        </ul>
      </div>
      
      <div class="footer-column">
        <h3>Customer Service</h3>
        <ul class="footer-links">
          <li><a href="#">Shipping Policy</a></li>
          <li><a href="#">Returns & Refunds</a></li>
          <li><a href="#">FAQs</a></li>
          <li><a href="#">Terms of Service</a></li>
        </ul>
      </div>
      
      <div class="footer-column">
        <h3>Newsletter</h3>
        <p>Subscribe to our newsletter to get updates on new products and special offers.</p>
        <form class="newsletter-form">
          <input type="email" class="newsletter-input" placeholder="Your email address">
          <button type="submit" class="newsletter-button">‚Üí</button>
        </form>
      </div>
    </div>
    
    <div class="container footer-bottom">
      <p>&copy; 2025 ShopEase. All rights reserved.</p>
    </div>
  </footer>
  <script>
    document.querySelector('.add-product-form').addEventListener('submit', sendData);
      function sendData(e) {
      e.preventDefault(); 
const payload = {
  productname: document.getElementById('productName').value,
  price: document.getElementById('productPrice').value,
  category: document.getElementById('productCategory').value,
  description: document.getElementById('productDescription').value,
  quantity: document.getElementById('productQuantity').value,
  status: document.getElementById('productStatus').value,
  image: document.getElementById('img').value
};


  axios.post('http://localhost:3000/addproduct', payload)
    .then(response => {alert('New product added!');localStorage.setItem('lastAddedProduct', JSON.stringify(response.data.product));})
    
    .catch(error => console.error(error));
}

function addProductToDOM(product) {
  console.log("Adding product:", product); 
  
  const container = document.querySelector(".product-grid"); 
  const div = document.createElement('div');
  div.className = "product-card";

  // Check if product and image data exist
  if (!product || !product.image|| !product.productname || !product.price) {
    console.error("Invalid product data:", product);
  } else {
    div.innerHTML = `
      <div class="product-image-container">
        <img src="${product.image}" class="product-image"/>
      </div>
      <div class="product-details">
        <h3 class="product-title">${product.productname}</h3>
        <div class="product-price">$${product.price}</div>
        <p class="product-description">${product.description}</p>
        <div class="product-actions">
          <a href="#" class="add-to-cart">Add to Cart</a>
          <button class="wishlist-button">‚ù§</button>
        </div>
      </div>
    `;
  }
  
  container.appendChild(div);
}
window.onload = async () => {
  try {
    console.log("Fetching products...");
    const res = await axios.get('http://localhost:3000/product');
    console.log("Products received:", res.data);
    
    if (res.data && res.data.length > 0) {
      res.data.forEach(addProductToDOM);
    } else {
      console.log("No products found");
      document.querySelector(".product-grid").innerHTML = '<p>No products available</p>';
    }
         // Display last added product from localStorage
    const lastProduct = localStorage.getItem('lastAddedProduct');
    if (lastProduct) {
      const product = JSON.parse(lastProduct);
      console.log("Last added product from localStorage:", product);
      const msgDiv = document.createElement('div');
      msgDiv.innerHTML = `<p>Last product you added: <strong>${product.productname}</strong> ($${product.price})</p>`;
      document.body.prepend(msgDiv);
    }
  }
   catch (err) {
    console.error("Failed to load products:", err);
    document.querySelector(".product-grid").innerHTML = '<p>Failed to load products. Please try again later.</p>';
  }
}

async function searchProduct(e) {
  e.preventDefault();
  const searchInput = document.getElementById("search-input").value;
  const resultDiv = document.getElementById("result");
  
  if (!searchInput || searchInput.trim() === '') {
    resultDiv.innerHTML = '<p>Please enter a product name to search</p>';
    return;
  }

  resultDiv.innerHTML = '<p>Searching...</p>';
  console.log("Searching for:", searchInput);
  
  try {
    const res = await axios.get(`http://localhost:3000/search?q=${encodeURIComponent(searchInput)}`);
    console.log("Search response:", res.data);
    
    if (res.data.found) {
      resultDiv.innerHTML = `
        <div class="search-result">
          <h3>Search Result:</h3>
          <div class="product-card">
            <div class="product-image-container">
              <img src="${res.data.product.image}" class="product-image" style="max-width:200px"/>
            </div>
            <div class="product-details">
              <h3 class="product-title">${res.data.product.productname}</h3>
              <div class="product-price">$${res.data.product.price}</div>
              <p class="product-description">${res.data.product.description}</p>
              <div class="product-actions">
                <a href="#" class="add-to-cart">Add to Cart</a>
                <button class="wishlist-button">‚ù§</button>
              </div>
            </div>
          </div>
        </div>
      `;
    } else {
      resultDiv.innerHTML = '<p>Product not found. Please try a different search term.</p>';
    }
  } catch (err) {
    console.error("Search error:", err);
    resultDiv.innerHTML = '<p>Error occurred while searching for products. Please try again later.</p>';
  }
}
</script>
</body>
</html>